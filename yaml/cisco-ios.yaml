name: cisco_ios
description: "Cisco IOS logs"
title: "Cisco IOS"
autoloader:
  inputs:
  - /Volumes/logs/logs/logs/dsl_grp/cisco/ios/ # CHANGE ME! /Volumes/logs/<SOURCE>/<SOURCE_TYPE>/
  format: text
  cloudFiles:
    schemaHints: "value string"

bronze:
  name: cisco_ios_bronze
  preTransform:
    -
      - "*"
      # - "_metadata.file_path"
      - TO_TIMESTAMP(REGEXP_EXTRACT(value, '(\\w+\\s+\\d+\\s+\\d+\\s+\\d+:\\d+:\\d+)', 1), 'MMM d yyyy HH:mm:ss') as time
      - CAST(time AS DATE) as date
      # - REGEXP_EXTRACT(value, '^([\\w\\-\\.]+):', 1) as host  # Optional: device hostname (if present)
      - CAST('cisco' AS STRING) AS source
      - CAST('ios' AS STRING) AS sourcetype
      - CURRENT_TIMESTAMP() as processed_time
silver:
  transform:
    - name: cisco_ios_silver
      fields:
        - name: seq_no
          expr: REGEXP_EXTRACT(value, '^(\\d+):\\s+(\\w+\\s+\\d+\\s+\\d+\\s+\\d+:\\d+:\\d+):\\s+%(\\w+)-(\\d+)-(\\w+):\\s(.+)$', 1)
        - name: timestamp
          expr: REGEXP_EXTRACT(value, '^(\\d+):\\s+(\\w+\\s+\\d+\\s+\\d+\\s+\\d+:\\d+:\\d+):\\s+%(\\w+)-(\\d+)-(\\w+):\\s(.+)$', 2)
        - name: facility
          expr: REGEXP_EXTRACT(value, '^(\\d+):\\s+(\\w+\\s+\\d+\\s+\\d+\\s+\\d+:\\d+:\\d+):\\s+%(\\w+)-(\\d+)-(\\w+):\\s(.+)$', 3)
        - name: severity
          expr: REGEXP_EXTRACT(value, '^(\\d+):\\s+(\\w+\\s+\\d+\\s+\\d+\\s+\\d+:\\d+:\\d+):\\s+%(\\w+)-(\\d+)-(\\w+):\\s(.+)$', 4)
        - name: mnemonic
          expr: REGEXP_EXTRACT(value, '^(\\d+):\\s+(\\w+\\s+\\d+\\s+\\d+\\s+\\d+:\\d+:\\d+):\\s+%(\\w+)-(\\d+)-(\\w+):\\s(.+)$', 5)
        - name: description
          expr: REGEXP_EXTRACT(value, '^(\\d+):\\s+(\\w+\\s+\\d+\\s+\\d+\\s+\\d+:\\d+:\\d+):\\s+%(\\w+)-(\\d+)-(\\w+):\\s(.+)$', 6)
      utils:
        unreferencedColumns:
          preserve: true
gold:
  # Note: clusterBy is supported in SSS (Spark Structured Streaming) mode but not in SDP mode (sinks don't support it atm)
  # For SDP mode, run ALTER TABLE after pipeline creation:
  #   ALTER TABLE <catalog>.<database>.<table_name> CLUSTER BY (time, <other_fields>)
  - name: authentication
    input: cisco_ios_silver
    # catalog: my_catalog  # Optional: Unity Catalog catalog name
    # database: my_database  # Optional: database name (required if catalog is specified)
    filter: (facility IN ('AAA', 'SEC_LOGIN') AND mnemonic LIKE 'LOGIN%') OR (facility = 'SYS' AND mnemonic = 'LOGOUT')
    # clusterBy: ["time", "user.name"]  # Only works in SSS mode (src/sss_gold.py)
    fields:
      - name: category_uid
        expr: CAST('3' AS INT)
      - name: category_name
        literal: Identity & Access Management
      - name: class_uid
        expr: CAST('3002' AS INT)
      - name: class_name
        literal: Authentication
      - name: type_uid
        expr: |
          CASE 
            WHEN mnemonic = 'LOGOUT' THEN CAST('300202' AS BIGINT)
            WHEN UPPER(mnemonic) LIKE '%SUCCESS%' OR severity = '5' THEN CAST('300201' AS BIGINT)
            WHEN UPPER(mnemonic) LIKE '%FAIL%' OR severity = '4' THEN CAST('300202' AS BIGINT)
            ELSE CAST('300200' AS BIGINT)
          END
      - name: activity_id
        expr: |
          CASE 
            WHEN mnemonic = 'LOGOUT' THEN CAST('2' AS INT)
            WHEN UPPER(mnemonic) LIKE '%SUCCESS%' OR severity = '5' THEN CAST('1' AS INT)
            WHEN UPPER(mnemonic) LIKE '%FAIL%' OR severity = '4' THEN CAST('2' AS INT)
            ELSE CAST('0' AS INT)
          END
      - name: activity_name
        expr: |
          CASE 
            WHEN mnemonic = 'LOGOUT' THEN 'Logoff'
            WHEN UPPER(mnemonic) LIKE '%SUCCESS%' OR severity = '5' THEN 'Logon'
            WHEN UPPER(mnemonic) LIKE '%FAIL%' OR severity = '4' THEN 'Logoff'
            ELSE 'Unknown'
          END
      - name: activity
        expr: |
          CASE 
            WHEN mnemonic = 'LOGOUT' THEN 'Logoff'
            WHEN UPPER(mnemonic) LIKE '%SUCCESS%' OR severity = '5' THEN 'Logon'
            WHEN UPPER(mnemonic) LIKE '%FAIL%' OR severity = '4' THEN 'Logoff'
            ELSE 'Unknown'
          END
      - name: action
        expr: |
          CASE 
            WHEN UPPER(mnemonic) LIKE '%SUCCESS%' OR mnemonic = 'LOGOUT' THEN 'Allowed'
            WHEN UPPER(mnemonic) LIKE '%FAIL%' THEN 'Denied'
            ELSE 'Other'
          END
      - name: action_id
        expr: |
          CAST(CASE 
            WHEN UPPER(mnemonic) LIKE '%SUCCESS%' OR mnemonic = 'LOGOUT' THEN 1
            WHEN UPPER(mnemonic) LIKE '%FAIL%' THEN 2
            ELSE 99
          END AS INT)
      - name: status_id
        expr: |
          CASE 
            WHEN UPPER(mnemonic) LIKE '%SUCCESS%' OR severity = '5' OR mnemonic = 'LOGOUT' THEN CAST('1' AS INT)
            WHEN UPPER(mnemonic) LIKE '%FAIL%' OR severity = '4' THEN CAST('2' AS INT)
            ELSE CAST('99' AS INT)
          END
      - name: status
        expr: |
          CASE 
            WHEN UPPER(mnemonic) LIKE '%SUCCESS%' OR severity = '5' OR mnemonic = 'LOGOUT' THEN 'Success'
            WHEN UPPER(mnemonic) LIKE '%FAIL%' OR severity = '4' THEN 'Failure'
            ELSE 'Other'
          END
      - name: status_code
        from: mnemonic
      - name: status_detail
        from: description
      - name: disposition
        expr: |
          CASE 
            WHEN UPPER(mnemonic) LIKE '%SUCCESS%' OR mnemonic = 'LOGOUT' THEN 'Allowed'
            WHEN UPPER(mnemonic) LIKE '%FAIL%' THEN 'Blocked'
            ELSE 'Unknown'
          END
      - name: disposition_id
        expr: |
          CAST(CASE 
            WHEN UPPER(mnemonic) LIKE '%SUCCESS%' OR mnemonic = 'LOGOUT' THEN 1
            WHEN UPPER(mnemonic) LIKE '%FAIL%' THEN 2
            ELSE 0
          END AS INT)
      - name: severity_id
        expr: |
          CASE 
            WHEN CAST(severity AS INT) = 0 THEN CAST('6' AS INT)
            WHEN CAST(severity AS INT) = 1 THEN CAST('5' AS INT)
            WHEN CAST(severity AS INT) = 2 THEN CAST('5' AS INT)
            WHEN CAST(severity AS INT) = 3 THEN CAST('4' AS INT)
            WHEN CAST(severity AS INT) = 4 THEN CAST('3' AS INT)
            WHEN CAST(severity AS INT) = 5 THEN CAST('2' AS INT)
            WHEN CAST(severity AS INT) = 6 THEN CAST('1' AS INT)
            WHEN CAST(severity AS INT) = 7 THEN CAST('1' AS INT)
            ELSE CAST('99' AS INT)
          END
      - name: severity
        expr: |
          CASE 
            WHEN CAST(severity AS INT) = 0 THEN 'Fatal'
            WHEN CAST(severity AS INT) = 1 THEN 'Critical'
            WHEN CAST(severity AS INT) = 2 THEN 'Critical'
            WHEN CAST(severity AS INT) = 3 THEN 'High'
            WHEN CAST(severity AS INT) = 4 THEN 'Medium'
            WHEN CAST(severity AS INT) = 5 THEN 'Low'
            WHEN CAST(severity AS INT) = 6 THEN 'Informational'
            WHEN CAST(severity AS INT) = 7 THEN 'Informational'
            ELSE 'Other'
          END
      - name: time
        from: time
      - name: timezone_offset
        expr: CAST(NULL AS INT)
      - name: type_name
        expr: |
          CONCAT('Authentication: ', 
            CASE 
              WHEN mnemonic = 'LOGOUT' THEN 'Logoff'
              WHEN UPPER(mnemonic) LIKE '%SUCCESS%' OR severity = '5' THEN 'Logon'
              WHEN UPPER(mnemonic) LIKE '%FAIL%' OR severity = '4' THEN 'Logoff'
              ELSE 'Unknown'
            END
          )
      - name: message
        from: description
      - name: auth_protocol
        literal: Unknown
      - name: auth_protocol_id
        expr: CAST(0 AS INT)
      - name: is_remote
        expr: |
          CAST(CASE 
            WHEN (CASE
                    WHEN mnemonic = 'LOGOUT' THEN REGEXP_EXTRACT(description, '\\((\\d+\\.\\d+\\.\\d+\\.\\d+)\\)', 1)
                    ELSE REGEXP_EXTRACT(description, 'Source:\\s*(\\d+\\.\\d+\\.\\d+\\.\\d+)', 1)
                  END) IS NOT NULL AND 
                 (CASE
                    WHEN mnemonic = 'LOGOUT' THEN REGEXP_EXTRACT(description, '\\((\\d+\\.\\d+\\.\\d+\\.\\d+)\\)', 1)
                    ELSE REGEXP_EXTRACT(description, 'Source:\\s*(\\d+\\.\\d+\\.\\d+\\.\\d+)', 1)
                  END) != ''
            THEN TRUE 
            ELSE FALSE 
          END AS BOOLEAN)
      - name: metadata.version
        literal: "1.7.0"
      - name: metadata.product.name
        literal: IOS
      - name: metadata.product.vendor_name
        literal: Cisco
      - name: metadata.log_provider
        literal: cisco
      - name: metadata.log_name
        literal: ios
      - name: metadata.log_format
        literal: syslog
      - name: metadata.log_version
        literal: "cisco@ios:version@1.0"
      - name: metadata.processed_time
        expr: CURRENT_TIMESTAMP()
      - name: metadata.logged_time
        from: time
      - name: metadata.event_code
        from: mnemonic
      - name: metadata.uid
        from: seq_no
      - name: user.name
        expr: |
          CASE
            WHEN mnemonic = 'LOGOUT' THEN REGEXP_EXTRACT(description, 'User\\s+(\\w+)', 1)
            ELSE REGEXP_EXTRACT(description, 'user:\\s*(\\w+)', 1)
          END
      - name: src_endpoint.ip
        expr: |
          CASE
            WHEN mnemonic = 'LOGOUT' THEN REGEXP_EXTRACT(description, '\\((\\d+\\.\\d+\\.\\d+\\.\\d+)\\)', 1)
            ELSE REGEXP_EXTRACT(description, 'Source:\\s*(\\d+\\.\\d+\\.\\d+\\.\\d+)', 1)
          END
      - name: src_endpoint.port
        expr: TRY_CAST(REGEXP_EXTRACT(description, 'localport:\\s*(\\d+)', 1) AS INT)
      - name: raw_data
        expr: CAST(to_json(named_struct('value', value, 'source', 'cisco', 'sourcetype', 'ios')) AS VARIANT)
      - name: unmapped
        expr: |
          CAST(
            to_json(
              named_struct(
                'seq_no', seq_no,
                'facility', facility,
                'severity', severity,
                'mnemonic', mnemonic,
                'timestamp', timestamp
              )
            )
          AS VARIANT)
  - name: authorize_session
    input: cisco_ios_silver
    # catalog: my_catalog  # Optional: Unity Catalog catalog name
    # database: my_database  # Optional: database name (required if catalog is specified)
    filter: mnemonic IN ('EXEC_FAILED', 'CLI_DENIED', 'ACCESS_DENIED')
    fields:
      - name: category_uid
        expr: CAST('3' AS INT)
      - name: category_name
        literal: Identity & Access Management
      - name: class_uid
        expr: CAST('3003' AS INT)
      - name: class_name
        literal: Authorize Session
      - name: type_uid
        expr: CAST('300399' AS BIGINT)
      - name: activity_id
        expr: CAST(99 AS INT)
      - name: activity_name
        literal: Other
      - name: action
        literal: Denied
      - name: action_id
        expr: CAST(2 AS INT)
      - name: status_id
        expr: CAST(2 AS INT)
      - name: status
        literal: Failure
      - name: status_code
        from: mnemonic
      - name: status_detail
        from: description
      - name: severity_id
        expr: |
          CASE 
            WHEN CAST(severity AS INT) = 0 THEN CAST('6' AS INT)
            WHEN CAST(severity AS INT) = 1 THEN CAST('5' AS INT)
            WHEN CAST(severity AS INT) = 2 THEN CAST('5' AS INT)
            WHEN CAST(severity AS INT) = 3 THEN CAST('4' AS INT)
            WHEN CAST(severity AS INT) = 4 THEN CAST('3' AS INT)
            WHEN CAST(severity AS INT) = 5 THEN CAST('2' AS INT)
            WHEN CAST(severity AS INT) = 6 THEN CAST('1' AS INT)
            WHEN CAST(severity AS INT) = 7 THEN CAST('1' AS INT)
            ELSE CAST('99' AS INT)
          END
      - name: severity
        expr: |
          CASE 
            WHEN CAST(severity AS INT) = 0 THEN 'Fatal'
            WHEN CAST(severity AS INT) = 1 THEN 'Critical'
            WHEN CAST(severity AS INT) = 2 THEN 'Critical'
            WHEN CAST(severity AS INT) = 3 THEN 'High'
            WHEN CAST(severity AS INT) = 4 THEN 'Medium'
            WHEN CAST(severity AS INT) = 5 THEN 'Low'
            WHEN CAST(severity AS INT) = 6 THEN 'Informational'
            WHEN CAST(severity AS INT) = 7 THEN 'Informational'
            ELSE 'Other'
          END
      - name: time
        from: time
      - name: timezone_offset
        expr: CAST(NULL AS INT)
      - name: type_name
        literal: 'Authorize Session: Other'
      - name: message
        from: description
      - name: metadata.version
        literal: "1.7.0"
      - name: metadata.product.name
        literal: IOS
      - name: metadata.product.vendor_name
        literal: Cisco
      - name: metadata.log_provider
        literal: cisco
      - name: metadata.log_name
        literal: ios
      - name: metadata.log_format
        literal: syslog
      - name: metadata.log_version
        literal: "cisco@ios:version@1.0"
      - name: metadata.processed_time
        expr: CURRENT_TIMESTAMP()
      - name: metadata.logged_time
        from: time
      - name: metadata.event_code
        from: mnemonic
      - name: metadata.uid
        from: seq_no
      - name: user.name
        expr: REGEXP_EXTRACT(description, 'User\\s+(\\w+)', 1)
      - name: dst_endpoint.svc_name
        expr: REGEXP_EXTRACT(description, 'attempted to\\s+(\\w+)', 1)
      - name: raw_data
        expr: CAST(to_json(named_struct('value', value, 'source', 'cisco', 'sourcetype', 'ios')) AS VARIANT)
      - name: unmapped
        expr: |
          CAST(
            to_json(
              named_struct(
                'seq_no', seq_no,
                'facility', facility,
                'severity', severity,
                'mnemonic', mnemonic,
                'timestamp', timestamp
              )
            )
          AS VARIANT)
  - name: network_activity
    input: cisco_ios_silver
    # catalog: my_catalog  # Optional: Unity Catalog catalog name
    # database: my_database  # Optional: database name (required if catalog is specified)
    filter: facility IN ('LINK', 'LINEPROTO', 'ETHCNTR', 'IFMON', 'DEBUG')
    fields:
      - name: category_uid
        expr: CAST('4' AS INT)
      - name: category_name
        literal: Network Activity
      - name: class_uid
        expr: CAST('4001' AS INT)
      - name: class_name
        literal: Network Activity
      - name: type_uid
        expr: |
          CASE 
            WHEN mnemonic = 'UPDOWN' AND UPPER(description) LIKE '%UP%' THEN CAST('400101' AS BIGINT)
            WHEN mnemonic = 'UPDOWN' AND UPPER(description) LIKE '%DOWN%' THEN CAST('400102' AS BIGINT)
            ELSE CAST('400199' AS BIGINT)
          END
      - name: activity_id
        expr: |
          CASE 
            WHEN mnemonic = 'UPDOWN' AND UPPER(description) LIKE '%UP%' THEN CAST('1' AS INT)
            WHEN mnemonic = 'UPDOWN' AND UPPER(description) LIKE '%DOWN%' THEN CAST('2' AS INT)
            ELSE CAST('99' AS INT)
          END
      - name: activity_name
        expr: |
          CASE 
            WHEN mnemonic = 'UPDOWN' AND UPPER(description) LIKE '%UP%' THEN 'Open'
            WHEN mnemonic = 'UPDOWN' AND UPPER(description) LIKE '%DOWN%' THEN 'Close'
            ELSE 'Other'
          END
      - name: activity
        expr: |
          CASE 
            WHEN mnemonic = 'UPDOWN' AND UPPER(description) LIKE '%UP%' THEN 'Open'
            WHEN mnemonic = 'UPDOWN' AND UPPER(description) LIKE '%DOWN%' THEN 'Close'
            ELSE 'Other'
          END
      - name: action
        expr: |
          CASE 
            WHEN mnemonic = 'UPDOWN' AND UPPER(description) LIKE '%UP%' THEN 'Allowed'
            WHEN mnemonic = 'UPDOWN' AND UPPER(description) LIKE '%DOWN%' THEN 'Blocked'
            ELSE 'Other'
          END
      - name: action_id
        expr: |
          CAST(CASE 
            WHEN mnemonic = 'UPDOWN' AND UPPER(description) LIKE '%UP%' THEN 1
            WHEN mnemonic = 'UPDOWN' AND UPPER(description) LIKE '%DOWN%' THEN 2
            ELSE 99
          END AS INT)
      - name: status_id
        expr: CAST('99' AS INT)
      - name: status
        literal: Other
      - name: status_code
        from: mnemonic
      - name: status_detail
        from: description
      - name: disposition
        expr: |
          CASE 
            WHEN mnemonic = 'UPDOWN' AND UPPER(description) LIKE '%UP%' THEN 'Allowed'
            WHEN mnemonic = 'UPDOWN' AND UPPER(description) LIKE '%DOWN%' THEN 'Blocked'
            ELSE 'Unknown'
          END
      - name: disposition_id
        expr: |
          CAST(CASE 
            WHEN mnemonic = 'UPDOWN' AND UPPER(description) LIKE '%UP%' THEN 1
            WHEN mnemonic = 'UPDOWN' AND UPPER(description) LIKE '%DOWN%' THEN 2
            ELSE 0
          END AS INT)
      - name: severity_id
        expr: |
          CASE 
            WHEN CAST(severity AS INT) = 0 THEN CAST('6' AS INT)
            WHEN CAST(severity AS INT) = 1 THEN CAST('5' AS INT)
            WHEN CAST(severity AS INT) = 2 THEN CAST('5' AS INT)
            WHEN CAST(severity AS INT) = 3 THEN CAST('4' AS INT)
            WHEN CAST(severity AS INT) = 4 THEN CAST('3' AS INT)
            WHEN CAST(severity AS INT) = 5 THEN CAST('2' AS INT)
            WHEN CAST(severity AS INT) = 6 THEN CAST('1' AS INT)
            WHEN CAST(severity AS INT) = 7 THEN CAST('1' AS INT)
            ELSE CAST('99' AS INT)
          END
      - name: severity
        expr: |
          CASE 
            WHEN CAST(severity AS INT) = 0 THEN 'Fatal'
            WHEN CAST(severity AS INT) = 1 THEN 'Critical'
            WHEN CAST(severity AS INT) = 2 THEN 'Critical'
            WHEN CAST(severity AS INT) = 3 THEN 'High'
            WHEN CAST(severity AS INT) = 4 THEN 'Medium'
            WHEN CAST(severity AS INT) = 5 THEN 'Low'
            WHEN CAST(severity AS INT) = 6 THEN 'Informational'
            WHEN CAST(severity AS INT) = 7 THEN 'Informational'
            ELSE 'Other'
          END
      - name: time
        from: time
      - name: start_time
        from: time
      - name: end_time
        expr: CAST(NULL AS TIMESTAMP)
      - name: timezone_offset
        expr: CAST(NULL AS INT)
      - name: type_name
        expr: |
          CONCAT('Network Activity: ', 
            CASE 
              WHEN mnemonic = 'UPDOWN' AND UPPER(description) LIKE '%UP%' THEN 'Open'
              WHEN mnemonic = 'UPDOWN' AND UPPER(description) LIKE '%DOWN%' THEN 'Close'
              ELSE 'Other'
            END
          )
      - name: message
        from: description
      - name: metadata.version
        literal: "1.7.0"
      - name: metadata.product.name
        literal: IOS
      - name: metadata.product.vendor_name
        literal: Cisco
      - name: metadata.log_provider
        literal: cisco
      - name: metadata.log_name
        literal: ios
      - name: metadata.log_format
        literal: syslog
      - name: metadata.log_version
        literal: "cisco@ios:version@1.0"
      - name: metadata.processed_time
        expr: CURRENT_TIMESTAMP()
      - name: metadata.logged_time
        from: time
      - name: metadata.event_code
        from: mnemonic
      - name: metadata.uid
        from: seq_no
      - name: connection_info.uid
        from: seq_no
      - name: connection_info.protocol_name
        from: facility
      - name: dst_endpoint.interface_name
        expr: REGEXP_EXTRACT(description, 'Interface\\s+([^,]+)', 1)
      - name: raw_data
        expr: CAST(to_json(named_struct('value', value, 'source', 'cisco', 'sourcetype', 'ios')) AS VARIANT)
      - name: unmapped
        expr: |
          CAST(
            to_json(
              named_struct(
                'seq_no', seq_no,
                'facility', facility,
                'severity', severity,
                'mnemonic', mnemonic,
                'timestamp', timestamp
              )
            )
          AS VARIANT)
  - name: process_activity
    input: cisco_ios_silver
    # catalog: my_catalog  # Optional: Unity Catalog catalog name
    # database: my_database  # Optional: database name (required if catalog is specified)
    filter: facility IN ('SYS', 'CPU', 'MEM', 'ENV')
    fields:
      - name: category_uid
        expr: CAST('1' AS INT)
      - name: category_name
        literal: System Activity
      - name: class_uid
        expr: CAST('1007' AS INT)
      - name: class_name
        literal: Process Activity
      - name: type_uid
        expr: |
          CASE 
            WHEN mnemonic = 'RELOAD' THEN CAST('100799' AS BIGINT)
            WHEN mnemonic LIKE '%FAILURE%' THEN CAST('100799' AS BIGINT)
            ELSE CAST('100799' AS BIGINT)
          END
      - name: activity_id
        expr: CAST(99 AS INT)
      - name: activity_name
        literal: Other
      - name: activity
        literal: Other
      - name: action
        expr: |
          CASE 
            WHEN mnemonic LIKE '%FAILURE%' THEN 'Failed'
            ELSE 'Allowed'
          END
      - name: action_id
        expr: |
          CAST(CASE 
            WHEN mnemonic LIKE '%FAILURE%' THEN 0
            ELSE 1
          END AS INT)
      - name: status_id
        expr: |
          CASE 
            WHEN mnemonic LIKE '%FAILURE%' THEN CAST(2 AS INT)
            ELSE CAST(1 AS INT)
          END
      - name: status
        expr: |
          CASE 
            WHEN mnemonic LIKE '%FAILURE%' THEN 'Failure'
            ELSE 'Success'
          END
      - name: status_code
        from: mnemonic
      - name: status_detail
        from: description
      - name: disposition
        expr: |
          CASE 
            WHEN mnemonic LIKE '%FAILURE%' THEN 'Failed'
            ELSE 'Allowed'
          END
      - name: disposition_id
        expr: |
          CAST(CASE 
            WHEN mnemonic LIKE '%FAILURE%' THEN 4
            ELSE 1
          END AS INT)
      - name: severity_id
        expr: |
          CASE 
            WHEN CAST(severity AS INT) = 0 THEN CAST('6' AS INT)
            WHEN CAST(severity AS INT) = 1 THEN CAST('5' AS INT)
            WHEN CAST(severity AS INT) = 2 THEN CAST('5' AS INT)
            WHEN CAST(severity AS INT) = 3 THEN CAST('4' AS INT)
            WHEN CAST(severity AS INT) = 4 THEN CAST('3' AS INT)
            WHEN CAST(severity AS INT) = 5 THEN CAST('2' AS INT)
            WHEN CAST(severity AS INT) = 6 THEN CAST('1' AS INT)
            WHEN CAST(severity AS INT) = 7 THEN CAST('1' AS INT)
            ELSE CAST('99' AS INT)
          END
      - name: severity
        expr: |
          CASE 
            WHEN CAST(severity AS INT) = 0 THEN 'Fatal'
            WHEN CAST(severity AS INT) = 1 THEN 'Critical'
            WHEN CAST(severity AS INT) = 2 THEN 'Critical'
            WHEN CAST(severity AS INT) = 3 THEN 'High'
            WHEN CAST(severity AS INT) = 4 THEN 'Medium'
            WHEN CAST(severity AS INT) = 5 THEN 'Low'
            WHEN CAST(severity AS INT) = 6 THEN 'Informational'
            WHEN CAST(severity AS INT) = 7 THEN 'Informational'
            ELSE 'Other'
          END
      - name: time
        from: time
      - name: timezone_offset
        expr: CAST(NULL AS INT)
      - name: type_name
        literal: 'Process Activity: Other'
      - name: message
        from: description
      - name: metadata.version
        literal: "1.7.0"
      - name: metadata.product.name
        literal: IOS
      - name: metadata.product.vendor_name
        literal: Cisco
      - name: metadata.log_provider
        literal: cisco
      - name: metadata.log_name
        literal: ios
      - name: metadata.log_format
        literal: syslog
      - name: metadata.log_version
        literal: "cisco@ios:version@1.0"
      - name: metadata.processed_time
        expr: CURRENT_TIMESTAMP()
      - name: metadata.logged_time
        from: time
      - name: metadata.event_code
        from: mnemonic
      - name: metadata.uid
        from: seq_no
      - name: actor.user.name
        expr: |
          CASE
            WHEN mnemonic = 'RELOAD' THEN REGEXP_EXTRACT(description, 'requested by user\\s+(\\w+)', 1)
            WHEN mnemonic = 'CONFIG_I' THEN REGEXP_EXTRACT(description, 'by\\s+(\\w+)\\s+on', 1)
            ELSE NULL
          END
      - name: raw_data
        expr: CAST(to_json(named_struct('value', value, 'source', 'cisco', 'sourcetype', 'ios')) AS VARIANT)
      - name: unmapped
        expr: |
          CAST(
            to_json(
              named_struct(
                'seq_no', seq_no,
                'facility', facility,
                'severity', severity,
                'mnemonic', mnemonic,
                'timestamp', timestamp
              )
            )
          AS VARIANT)